{% extends "base.html" %}
{% set active_page = "overview" %}

{%- block extrahead %}

{% for script in scripts %}
 {{ script | safe }}
{% endfor %}

<script>
$( document ).ready(function() {

    $('#reload').on('click', function(){
        location.reload(true);
    });


    var ME = ME || {};
    ME.polling = true;

    function show_error(){
            ME.polling = false;
            // alert("Error: could not start crawl.")
            $( '#status' ).text( "Error (could not start crawl)" );
    }

    $('#playButton').on('click', function() {

        $( '#status' ).text( "Starting..." );

        $.ajax({
          type: "POST",
            url: "{{ url_for('run_crawl', project_slug=project.slug, crawl_slug=crawl.slug) }}",
          success: function(retval) {
            if (retval == "Error") show_error();
            else $( '#status' ).text(retval);
          },
          failure: function() {
            show_error();
          }
        });
    });

    $('#stopButton').on('click', function(){

        $( '#status' ).text( "Stopping..." );

        $.ajax({
          type: "POST",
            url: "{{ url_for('stop_crawl', project_slug=project.slug, crawl_slug=crawl.slug) }}",
          success: function(retval) {
            if (retval == "Error") show_error();
            else $( '#status' ).text(retval);
          },
          failure: function() {
            show_error();
          }
        });
    });

    (function pollStatus() {

      // If polling has been turned off, break the loop
      if (!ME.polling) return;

        $.ajax({
            url: "{{ url_for('status_crawl', project_slug=project.slug, crawl_slug=crawl.slug) }}",
            type: "GET",
            success: function(data) { $('#status').text( data ) },
            complete: setTimeout(pollStatus, 5000),
            timeout: 2000
        });
    })();

    $('#imageDump').on('click', function(){
        $.ajax({
          type: "POST",
          url: "/{{ project.slug }}/crawls/{{ crawl.slug }}/dump",
          success: console.log("crawlImagesDumped")
        }).done(function() {
          window.location.href = "/{{ project.slug }}/image_space/{{ crawl.slug }}"
        });
    });

    $('#stats').on('click', function(){
        $.ajax({
          type: "GET",
          url: "/{{ project.slug }}/crawls/{{ crawl.slug }}/stats",
          success: function(data) {
                $( '#stats-data' ).text( data );
                console.log("stats-data" + data);
            },
        });
    });

});

</script>

{% endblock %}

{% block content %}
{% include 'sidebar.html' %}
<div class='row'>
  <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <h1>{{ crawl.name }}</h1>
    <p>Crawl Status: <span id="status">Unknown</span></p>
  </div>
</div>
<div class='row'>
        <div class='col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 controls'>
            <div class='col-xs-2'>
              <button id="playButton" title="Start Crawl" type="button" class="btn btn-control">
                  <i class="fa fa-play"></i>
              </button>
              <button id="stopButton" title="Stop Crawl" type="button" class="btn btn-control">
                  <span class="fa fa-stop"></span>
              </button>
              </div>
              <div class='col-xs-2'>
              <!-- <button id="seedButton" type="button" class="btn btn-control">
                  <i class="fa fa-file-o"></i>
              </button> -->
              <a href="{{ url_for('edit_crawl', project_slug=project.slug, crawl_slug=crawl.slug) }}" style='text-decoration:none;'>
                <button id="editButton" type="button" title="Edit Crawl" class="btn btn-control">
                  <i class="fa fa-edit"></i>
                </button>
              </a>
              <form onsubmit='return confirm("Are you sure?");' class='form-button'>
                <button formmethod='post' formaction="{{ url_for('delete_crawl', project_slug=project.slug, crawl_slug=crawl.slug) }}" id="removeButton" type="submit" title="Delete Crawl" class="btn btn-control">
                    <span class="fa fa-close"></span>
                </button>
              </form>
            </div>
      </div>

  </div>

<div class='row'>
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        {% if divs %}
        {% for div in divs %}
            <div class='col-sm-6'>
                {{ div | safe }}
            </div>
        {% endfor %}
        {% else %}
        <h1>There are no plots to show.</h1>
       {% endif %}
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <!-- <button type="button" id="reload" class="btn btn-primary">Refresh</button> -->
            <button type="button" id="reload">Refresh</button>
        </div>
    </div>
</div>

<div class='row'>
  <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <button id="stats" type="button" title="Get crawl stats" class="btn btn-default btn-duo center">
           Stats
        </button>

        <button id="imageDump" type="button" title="Dump crawled images" class="btn btn-default btn-duo center">
           Images
        </button>

      <h3>Description</h3>
      <p>The muchtreasured and intricately embroidered ancient Irish facecloth attributed to Solomon of Droma and Manus Tomaltach og MacDonogh, authors of the Book of Ballymote, was then carefully produced and called forth prolonged admiration. No need to dwell on the legendary beauty of the cornerpieces, the acme of art, wherein one can distinctly discern each of the four evangelists in turn presenting to each of the four masters his evangelical symbol, a bogoak sceptre, a North American puma (a far nobler king of beasts than the British article, be it said in passing), a Kerry calf and a golden eagle from Carrantuohill.</p>

      <h3>Summary Statistics</h3>
      <p><span id="stats-data"></span></p>
      <h3>Crawl Settings</h3>
      <p>...</p>
      <h3>Crawl Index</h3>
      <p>...</p>
    </div>


  </div>
</div>
</div>
{% endblock content %}
